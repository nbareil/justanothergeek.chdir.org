<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CVE-2010-0740: Record of death vulnerability in OpenSSL - Just Another Geek</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="CVE-2010-0740: Record of death vulnerability in OpenSSL" />
<meta property="og:description" content="It is a write-up of the CVE-2010-0740&#39;s vulnerability in OpenSSL" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://justanothergeek.chdir.org/2010/03/CVE-2010-0740-Record-of-death-vulnerability-in-OpenSSL/" /><meta property="article:published_time" content="2010-03-25T11:22:00&#43;00:00"/>
<meta property="article:modified_time" content="2010-03-25T11:22:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CVE-2010-0740: Record of death vulnerability in OpenSSL"/>
<meta name="twitter:description" content="It is a write-up of the CVE-2010-0740&#39;s vulnerability in OpenSSL"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://justanothergeek.chdir.org/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://justanothergeek.chdir.org/css/main.css" />

	
		<script src="https://justanothergeek.chdir.org/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://justanothergeek.chdir.org/">Just Another Geek</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">25</span>
							<span class="rest">Mar 2010</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">CVE-2010-0740: Record of death vulnerability in OpenSSL</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>A new vulnerability (CVE-2010-0740) was found in OpenSSL, affectionately
called &ldquo;<a href="http://www.openssl.org/news/secadv_20100324.txt">Record of
death</a>&rdquo; (in reference
to the <a href="http://insecure.org/sploits/ping-o-death.html">ping of death</a>
vulnerability back in 1996) was fixed by the patch below:</p>

<pre><code>--- ssl/s3_pkt.c 24 Jan 2010 13:52:38 -0000 1.57.2.9
+++ ssl/s3_pkt.c 24 Mar 2010 00:00:00 -0000
@@ -291,9 +291,9 @@
  if (version != s-&gt;version)
   {
   SSLerr(SSL_F_SSL3_GET_RECORD,SSL_R_WRONG_VERSION_NUMBER);
-  /* Send back error using their
-   * version number :-) */
-  s-&gt;version=version;
+                if ((s-&gt;version &amp; 0xFF00) == (version &amp; 0xFF00))
+                 /* Send back error using their minor version number :-) */
+   s-&gt;version = (unsigned short)version;
   al=SSL_AD_PROTOCOL_VERSION;
   goto f_err;
   }
</code></pre>

<p><a href="http://natisbad.org">Arno</a> and myself had a look on this vuln, but at a
glance, it&rsquo;s hard to understand the consequences of theses two
modifications:</p>

<ul>
<li>Comparison of the server version and the packet version</li>
<li>Use of cast for the assignment.</li>
</ul>

<p>The latter is the interesting part. <code>s-&gt;version</code> is declared as a <code>int</code>
(32 bits signed value on <code>x86</code>) and <code>version</code> is a <code>short</code> (16 bits
signed value on <code>x86</code>).</p>

<p>When doing the following assignment:</p>

<pre><code>int i_version;
short s_version;

i_version = s_version;
</code></pre>

<p>What are the problems? On <code>x86</code>, <code>i_version</code> is big enough to store
<code>s_version</code> so there is no truncation or overflow issues. However,
theses two variables are signed and the C has the following rule:</p>

<blockquote>
<p><em>Conversion of an operand value to a compatible type causes no change
to the value or the representation.</em></p>
</blockquote>

<p>In other words:</p>

<pre><code>short s;
int i;

s = -1;
i = s; /* i must be equal to -1 */
</code></pre>

<p>To do this, the compiler has to perform a <em>sign extension</em>, which means
that if the short value was negative, its integer value must stays
negative.</p>

<p>Internally, the most significant bit (msb) of the short variable will be
propagated in the integer variable for the &ldquo;upper bits&rdquo;. Examples:</p>

<pre><code>  |--------+-----+--------------|                                                                                                                                                                                                                                                                                               
  |  short | msb | integer      |                                                                                                                                                                                                                                                                                               
  |--------+-----+--------------|                                                                                                                                                                                                                                                                                               
  | 0x0000 |   0 | 0x00000000   |                                                                                                                                                                                                                                                                                               
  | 0x7000 |   0 | 0x00070000   |                                                                                                                                                                                                                                                                                               
  | 0x8000 |   1 | 0xffff0000   |                                                                                                                                                                                                                                                                                               
  | 0xffff |   1 | 0xffffffff   |  
  |--------+-----+--------------|                                                                                                                                                                                                                                                                                               
</code></pre>

<p>So if <code>version &gt;= 0x8000</code>, <code>s-&gt;version</code> will have a value
<code>&gt;= 0xffff0000</code> (a big negative value).</p>

<p>According to the advisory, this bug can cause a crash of an OpenSSL
end-point due to a read attempt at NULL.<br />
The OpenSSL code uses extensively indirect function pointers for
callbacks so it is hard to follow the code path without spending some
time, so I cannot confirm neither my hypothesis nor the impact of the
bug.</p>

			</div>

			<div class="tags">
				
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-13174242-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>
</html>
